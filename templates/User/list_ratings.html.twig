{% extends "layouts/base.html.twig" %}

{% import "macros/_macros_helpers.html.twig" as helper %}
{% import "macros/ui.html.twig" as ui %}

{% set title = 'users.ratings.title'|trans({'%name%': user.displayName}) %}
{% block title %}{{ title }}{% endblock %}

{% block body %}
  <div class="max-w-3xl mx-auto">
    {# Compact User Header #}
    <div class="flex items-center gap-3 mb-6">
      <a href="{{ path('user_show', {'slug': user.slug}) }}" class="shrink-0">
        {{ helper.profilePicture(user, 'w-10 h-10 rounded-full object-cover') }}
      </a>
      <div class="min-w-0 flex-1">
        <h1 class="text-lg font-bold text-neutral-900 dark:text-white truncate">
          {{ user.displayName }}
        </h1>
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          {{ 'user_list.rating'|trans({'count': ratings.getTotalItemCount()}) }}
        </p>
      </div>
      <a href="{{ path('user_show', {'slug': user.slug}) }}" 
         class="p-2 rounded-lg text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors">
        {{ ux_icon('tabler:arrow-left', {'class': 'w-5 h-5', 'aria-hidden': 'true'}) }}
      </a>
    </div>

    {% if ratings.getTotalItemCount() > 0 %}
      {# Sortable header - mobile friendly #}
      <div class="flex items-center gap-2 mb-4 overflow-x-auto pb-2 -mx-4 px-4 scrollbar-hide">
        <span class="text-xs text-neutral-500 dark:text-neutral-400 shrink-0">{{ 'filters.title'|trans }}:</span>
        <span class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 whitespace-nowrap">
          {{ knp_pagination_sortable(ratings, 'users.ratings.coaster'|trans, 'c.name') }}
        </span>
        <span class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 whitespace-nowrap">
          {{ knp_pagination_sortable(ratings, 'users.ratings.rating'|trans, 'r.value') }}
        </span>
        <span class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 whitespace-nowrap">
          {{ knp_pagination_sortable(ratings, 'users.ratings.ridden_at'|trans, 'r.riddenAt') }}
        </span>
      </div>

      {# Ratings List #}
      <div class="space-y-2">
        {% for rating in ratings %}
          <a href="{{ path('show_coaster', {'id': rating.coaster.id, 'slug': rating.coaster.slug}) }}" 
             class="flex items-center gap-3 p-3 bg-white dark:bg-neutral-900 rounded-xl border border-neutral-100 dark:border-neutral-800 hover:border-cc-blue-200 dark:hover:border-cc-blue-800 transition-colors">
            {# Coaster Image #}
            {% if rating.coaster.mainImage is not null %}
              <img src="{{ pictures_cdn }}/280x210/{{ rating.coaster.mainImage.filename }}"
                   class="w-14 h-10 rounded-lg object-cover shrink-0"
                   alt="{{ rating.coaster.name }}"
                   loading="lazy">
            {% endif %}

            {# Coaster Info #}
            <div class="flex-1 min-w-0">
              <div class="font-medium text-sm text-neutral-900 dark:text-white truncate">
                {{ rating.coaster.name }}
              </div>
              <div class="text-xs text-neutral-500 dark:text-neutral-400 truncate">
                {{ rating.coaster.park.name }}
                {% if rating.coaster.manufacturer %}
                  <span class="text-neutral-300 dark:text-neutral-600 mx-1">â€¢</span>
                  {{ rating.coaster.manufacturer.name }}
                {% endif %}
              </div>
            </div>

            {# Rating & Date #}
            <div class="shrink-0 text-right">
              {{ ui.starRating(rating.value, 'sm') }}
              {% if rating.riddenAt %}
                <div class="text-[10px] text-neutral-400 mt-0.5">{{ rating.riddenAt|date('M Y') }}</div>
              {% endif %}
            </div>
          </a>
        {% endfor %}
      </div>

      <div class="mt-6">
        {{ knp_pagination_render(ratings) }}
      </div>
    {% else %}
      {% include 'components/empty_state.html.twig' with {
        icon: 'tabler:star',
        title: 'user_profile.ratings'|trans,
        description: ''
      } %}
    {% endif %}
  </div>
{% endblock %}
