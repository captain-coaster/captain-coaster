{% extends "base.html.twig" %}

{% set title = 'nearby.title'|trans %}
{% block title %}{{ title }}{% endblock %}

{% set pageHasFilters = true %}

{% block secondary_sidebar %}
  {% include 'Includes/filter_sidebar.html.twig' with {
    'filters': filters, 
    'filtersForm': filtersForm,
    'filterConfig': {
      'endpoint': path('nearby_coasters_ajax'),
      'container_id': 'search-result',
      'update_url': true,
      'enabled_filters': ['status', 'name', 'manufacturer', 'score']
    }
  } only %}
{% endblock %}

{% block body %}
  <div id="search-result"></div>
{% endblock %}

{% block javascripts %}
  <script type="text/javascript">
    // Handle geolocation for nearby search
    document.addEventListener('DOMContentLoaded', function() {
      const filterController = document.querySelector('[data-controller*="filter"]');
      
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          document.getElementById('form-latitude').value = position.coords.latitude;
          document.getElementById('form-longitude').value = position.coords.longitude;
          
          // Trigger filter after geolocation
          if (filterController && filterController.filterController) {
            filterController.filterController.filterData();
          }
        }, function(error) {
          console.log('Geolocation error:', error);
          // Trigger filter even without geolocation
          if (filterController && filterController.filterController) {
            filterController.filterController.filterData();
          }
        });
      } else {
        // Trigger filter without geolocation
        if (filterController && filterController.filterController) {
          filterController.filterController.filterData();
        }
      }
    });
  </script>
{% endblock %}
