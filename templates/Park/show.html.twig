{% extends "layouts/base.html.twig" %}
{% import "macros/_macros_helpers.html.twig" as helper %}

{% set title = park.name %}
{% set subTitle = park.country.name|trans([], 'database') %}
{% block title %}{{ title }} â€¢ {{ subTitle }}{% endblock %}
{% if park.formerNames %}
    {% set secondaryTitle = park.formerNames|join(', ') %}
{% endif %}

{% block body %}
    <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
        <div class="md:col-span-3">
            <!-- park stats -->
            <div class="bg-white dark:bg-neutral-900 rounded-2xl shadow-sm overflow-hidden p-6 mb-3">
                <div class="grid grid-cols-1 md:grid-cols-12 gap-4 text-center">
                    <div class="col-span-6">
                        <p class="mb-1">{{ ux_icon('tabler:map-pin', {'class': 'icon-lg text-blue-600 dark:text-blue-400'}) }}</p>
                        <h5 class="font-semibold mb-0">
                            {{ park.openedCoasters|length }}
                        </h5>
                        <div class="text-neutral-600 dark:text-neutral-400 small">
                            {{ 'park.opened_coasters'|trans({'count': park.openedCoasters|length}) }}
                        </div>
                    </div>
                    <div class="col-span-6">
                        <p class="mb-1">{{ ux_icon('tabler:puzzle', {'class': 'icon-lg text-warning'}) }}</p>
                        <h5 class="font-semibold mb-0">
                            {{ park.operatingKiddies|length }}
                        </h5>
                        <div class="text-neutral-600 dark:text-neutral-400 small">
                            {{ 'park.kiddies'|trans({'count': park.operatingKiddies|length}) }}
                        </div>
                    </div>
                </div>
                {% if not is_granted('ROLE_USER') %}
                    <div class="text-center mt-3 pt-3 border-top">
                        <p class="text-neutral-600 dark:text-neutral-400 text-sm mb-2">
                            {{ 'coaster.rating.mustlogin'|trans }}
                        </p>
                        <a href="{{ path('login') }}" class="inline-flex items-center justify-center px-4 py-2.5 text-sm font-medium rounded-lg bg-cc-blue-600 text-white hover:bg-cc-blue-700 focus:outline-none focus:ring-2 focus:ring-cc-blue-500 transition-colors duration-200 text-xs px-3 py-1.5">{{ 'coaster.rating.login'|trans }}</a>
                    </div>
                {% endif %}
            </div>
            
            {% if park.latitude is not null and park.longitude is not null %}
                <div class="bg-white dark:bg-neutral-900 rounded-2xl shadow-sm overflow-hidden mb-3">
                    <div class="px-6 py-4 bg-neutral-50 dark:bg-neutral-800 border-b border-neutral-100 dark:border-neutral-700">
                        <h6 class="text-lg font-semibold text-neutral-900 dark:text-white mb-0">
                            {{ 'coaster.infos.closeParksTitle'|trans({'%parkName%': park.name}) }}
                        </h6>
                    </div>
                    <div class="p-6">
                        {% if closestParks %}
                            <ul class="list-feed mb-0">
                                {% for infoPark in closestParks %}
                                    <li>
                                        <a href="{{ path('park_show', {'id': infoPark.id, 'slug': infoPark.slug}) }}">
                                            {{ infoPark.name }}
                                        </a>
                                        <span class="text-neutral-600 dark:text-neutral-400">- {{ units.km_or_mi(infoPark.distance) }}</span>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="mb-0 text-muted">{{ 'coaster.infos.closeParksNone'|trans({'%parkName%': park.name}) }}</p>
                        {% endif %}
                    </div>
                    <div class="px-6 py-4 bg-neutral-50 dark:bg-neutral-800 border-t border-neutral-100 dark:border-neutral-700 text-center">
                        <a href="{{ path('map_index', {'parkslug': park.slug}) }}">{{ 'coaster.infos.closeParksLink'|trans({'%parkName%': park.name}) }}</a>
                    </div>
                </div>
            {% endif %}
            <!-- /park stats -->
        </div>
        <div class="md:col-span-9">
            <div class="space-y-2">
                {% for coaster in coasters %}
                    <div class="p-4 bg-white dark:bg-neutral-900 rounded-lg border border-neutral-200 dark:border-neutral-700 border-l border-{{ coaster.status.type }} border-4">
                        <div class="flex gap-3 flex-col md:flex-row">
                            <a href="{{ path('show_coaster', {'id': coaster.id, 'slug': coaster.slug}) }}" class="shrink-0">
                                <img {% if coaster.mainImage %}
                                    src="{{ pictures_cdn }}/280x210/{{ coaster.mainImage.filename }}"
                                {% else %}
                                    src="{{ asset('images/nophoto.png') }}"
                                {% endif %}
                                    class="rounded w-[200px] max-w-full" alt="{{ coaster.name }}">
                            </a>
                            <div class="flex-1">
                                <h5 class="mb-1">
                                    <a class="no-underline" href="{{ path('show_coaster', {'id': coaster.id, 'slug': coaster.slug}) }}">
                                        {{ coaster.name }}
                                    </a>
                                </h5>
                                <h6 class="mb-2" style="color: {{ helper.ratingColor(coaster.score) }};">
                                    {% if coaster.score %}
                                        {{ 'coaster.score.scoreof'|trans }} {{ coaster.score|number_format(1, ',') }}%
                                    {% else %}
                                        &nbsp;
                                    {% endif %}
                                </h6>
                                <ul class="inline-flex list-inline-separator text-neutral-600 dark:text-neutral-400 text-sm mb-2">
                                    {% if coaster.manufacturer %}
                                        <li class="inline-flex">
                                            <a class="text-neutral-600 dark:text-neutral-400" href="{{ path('ranking_index', {'filters[manufacturer]': coaster.manufacturer.id}) }}">
                                                {{ coaster.manufacturer.name }}
                                            </a>
                                        </li>
                                    {% endif %}
                                    {% if coaster.seatingType %}
                                        <li class="inline-flex">
                                            <a class="text-neutral-600 dark:text-neutral-400" href="{{ path('ranking_index', {'filters[seatingType]': coaster.seatingType.id}) }}">
                                                {{ coaster.seatingType.name }}
                                            </a>
                                        </li>
                                    {% endif %}
                                    {% if coaster.openingDate %}
                                        <li class="inline-flex">
                                            <a class="text-neutral-600 dark:text-neutral-400" href="{{ path('ranking_index', {'filters[openingDate]': coaster.openingDate|date('Y')}) }}">
                                                {{ coaster.openingDate|date('Y') }}
                                            </a>
                                        </li>
                                    {% endif %}
                                </ul>
                                <ul class="inline-flex list-inline-separator text-neutral-600 dark:text-neutral-400 text-sm mb-0">
                                    <li class="inline-flex flex items-center gap-1">
                                        {{ ux_icon('tabler:arrow-up', {'class': 'icon-xs text-warning'}) }}
                                        {% if coaster.height is null %}
                                            {{ ('data.unknown'|trans([], 'database')) }}
                                        {% else %}
                                            {{ units.m_or_f(coaster.height) }}
                                        {% endif %}
                                    </li>
                                    <li class="inline-flex flex items-center gap-1">
                                        {{ ux_icon('tabler:rocket', {'class': 'icon-xs text-success'}) }}
                                        {% if coaster.speed is null %}
                                            {{ ('data.unknown'|trans([], 'database')) }}
                                        {% else %}
                                            {{ units.kph_or_mph(coaster.speed) }}
                                        {% endif %}
                                    </li>
                                    <li class="inline-flex flex items-center gap-1">
                                        {{ ux_icon('tabler:arrows-maximize', {'class': 'icon-xs text-primary'}) }}
                                        {% if coaster.length is null %}
                                            {{ ('data.unknown'|trans([], 'database')) }}
                                        {% else %}
                                            {{ units.m_or_f(coaster.length) }}
                                        {% endif %}
                                    </li>
                                    <li class="inline-flex flex items-center gap-1">
                                        {{ ux_icon('tabler:refresh', {'class': 'icon-xs text-danger'}) }}
                                        {{ coaster.inversionsNumber|default('0') }}
                                    </li>
                                </ul>
                            </div>
                            {% if coaster.isRateable and is_granted('ROLE_USER') %}
                                <div class="shrink-0 text-center align-self-center">
                                    <div class="csrf-protection"
                                         data-controller="csrf-protection rating"
                                         data-csrf-protection-token-value="{{ csrf_token('rating') }}"
                                         data-rating-csrf-protection-outlet=".csrf-protection"
                                         data-rating-coaster-id-value="{{ coaster.id }}"
                                         data-rating-current-value-value="{{ app.user.coasterRating(coaster).value|default(0) }}"
                                         data-rating-rating-id-value="{{ app.user.coasterRating(coaster).id|default('') }}"
                                         data-rating-locale-value="{{ app.request.locale }}"
                                         data-rating-readonly-value="false"
                                         class="text-2xl"></div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% else %}
                    <div class="p-4 bg-white dark:bg-neutral-900 rounded-lg border border-neutral-200 dark:border-neutral-700">
                        <h5 class="mb-0">{{ 'coaster_ranking.no_results'|trans }}</h5>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
