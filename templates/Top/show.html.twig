{% extends "layouts/base.html.twig" %}

{% import "macros/_macros_helpers.html.twig" as helper %}
{% import "macros/ui.html.twig" as ui %}

{% set title = top.name %}
{% set subTitle = top.user.displayName %}
{% block title %}{{ title }} • {{ subTitle }}{% endblock %}

{% block body %}
  {# Header Card #}
  <div class="bg-white dark:bg-neutral-900 rounded-2xl shadow-sm overflow-hidden border border-neutral-100 dark:border-neutral-800 mb-6">
    <div class="p-4 sm:p-6">
      <div class="flex flex-col sm:flex-row sm:items-center gap-4">
        {# User info #}
        <div class="flex items-center gap-3 flex-1 min-w-0">
          <a href="{{ path('user_show', {'slug': top.user.slug}) }}" class="shrink-0">
            {{ helper.profilePicture(top.user, 'w-12 h-12 rounded-full object-cover ring-2 ring-white dark:ring-neutral-800') }}
          </a>
          <div class="min-w-0">
            <h1 class="text-lg sm:text-xl font-bold text-neutral-900 dark:text-white truncate flex items-center gap-2">
              {% if top.main %}
                <span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-green-100 dark:bg-green-900/30 shrink-0">
                  {{ ux_icon('tabler:check', {'class': 'w-3 h-3 text-green-600 dark:text-green-400', 'aria-hidden': 'true'}) }}
                </span>
              {% endif %}
              {{ top.name }}
            </h1>
            <p class="text-sm text-neutral-500 dark:text-neutral-400">
              {{ 'list.by'|trans({}, 'top') }}
              <a href="{{ path('user_show', {'slug': top.user.slug}) }}" class="hover:text-cc-blue-600 dark:hover:text-cc-blue-400 transition-colors">
                {{ top.user.displayName }}
              </a>
            </p>
          </div>
        </div>

        {# Stats and actions #}
        <div class="flex items-center gap-3 sm:gap-4">
          <div class="flex items-center gap-4 text-sm text-neutral-500 dark:text-neutral-400">
            <span class="inline-flex items-center gap-1.5">
              {{ ux_icon('tabler:list-numbers', {'class': 'w-4 h-4', 'aria-hidden': 'true'}) }}
              <span class="font-medium text-neutral-900 dark:text-white">{{ top.topCoasters|length }}</span>
            </span>
            <span class="inline-flex items-center gap-1.5">
              {{ ux_icon('tabler:clock', {'class': 'w-4 h-4', 'aria-hidden': 'true'}) }}
              {{ top.updatedAt|ago }}
            </span>
          </div>

          {% if is_granted('edit', top) or is_granted('delete', top) %}
            <div class="flex items-center gap-2">
              {% if is_granted('edit', top) %}
                <a href="{{ path('top_edit', {'id': top.id}) }}" 
                   class="inline-flex items-center justify-center w-9 h-9 rounded-lg bg-cc-blue-100 dark:bg-cc-blue-900/30 text-cc-blue-600 dark:text-cc-blue-400 hover:bg-cc-blue-200 dark:hover:bg-cc-blue-900/50 transition-colors"
                   title="{{ 'update'|trans({}, 'top') }}">
                  {{ ux_icon('tabler:edit', {'class': 'w-4 h-4', 'aria-hidden': 'true'}) }}
                </a>
              {% endif %}
              {% if is_granted('delete', top) %}
                <a href="{{ path('top_delete', {'id': top.id}) }}"
                   onclick="return confirm('{{ 'delete_confirmation'|trans({}, 'top') }}');"
                   class="inline-flex items-center justify-center w-9 h-9 rounded-lg bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors"
                   title="{{ 'delete'|trans({}, 'top') }}">
                  {{ ux_icon('tabler:trash', {'class': 'w-4 h-4', 'aria-hidden': 'true'}) }}
                </a>
              {% endif %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {# Coasters List #}
  {% if top.topCoasters|length > 0 %}
    <div class="space-y-3">
      {% for topCoaster in top.topCoasters %}
        {% set coaster = topCoaster.coaster %}
        <article class="bg-white dark:bg-neutral-900 rounded-xl shadow-sm border border-neutral-100 dark:border-neutral-800 overflow-hidden hover:shadow-md transition-all duration-200">
          <div class="flex items-stretch">
            {# Position indicator #}
            <div class="flex items-center justify-center w-14 sm:w-16 shrink-0
              {% if topCoaster.position == 1 %}bg-gradient-to-br from-cc-warm-400 to-cc-warm-500 text-white
              {% elseif topCoaster.position == 2 %}bg-gradient-to-br from-neutral-300 to-neutral-400 text-white
              {% elseif topCoaster.position == 3 %}bg-gradient-to-br from-orange-400 to-orange-500 text-white
              {% else %}bg-neutral-100 dark:bg-neutral-800 text-neutral-600 dark:text-neutral-400{% endif %}">
              <span class="text-xl sm:text-2xl font-bold">{{ topCoaster.position }}</span>
            </div>

            {# Coaster info #}
            <div class="flex-1 p-3 sm:p-4 flex items-center gap-3 sm:gap-4 min-w-0">
              {% if coaster.mainImage is not null %}
                <a href="{{ path('show_coaster', {'id': coaster.id, 'slug': coaster.slug}) }}" class="shrink-0 hidden sm:block">
                  <img src="{{ pictures_cdn }}/280x210/{{ coaster.mainImage.filename }}"
                       class="w-16 h-12 sm:w-20 sm:h-14 rounded-lg object-cover"
                       alt="{{ coaster.name }}"
                       loading="lazy">
                </a>
              {% endif %}

              <div class="flex-1 min-w-0">
                <h2 class="font-semibold text-neutral-900 dark:text-white truncate">
                  <a href="{{ path('show_coaster', {'id': coaster.id, 'slug': coaster.slug}) }}" 
                     class="hover:text-cc-blue-600 dark:hover:text-cc-blue-400 transition-colors">
                    {{ coaster.name }}
                  </a>
                </h2>
                <div class="flex flex-wrap items-center gap-x-2 gap-y-0.5 text-xs sm:text-sm text-neutral-500 dark:text-neutral-400 mt-0.5">
                  {% if coaster.manufacturer %}
                    <a href="{{ path('ranking_index', {'filters[manufacturer]': coaster.manufacturer.id}) }}" 
                       class="hover:text-cc-blue-600 dark:hover:text-cc-blue-400 transition-colors">
                      {{ coaster.manufacturer.name }}
                    </a>
                    <span class="text-neutral-300 dark:text-neutral-600">•</span>
                  {% endif %}
                  <a href="{{ path('park_show', {'id': coaster.park.id, 'slug': coaster.park.slug}) }}"
                     class="hover:text-cc-blue-600 dark:hover:text-cc-blue-400 transition-colors truncate">
                    {{ coaster.park.name }}
                  </a>
                </div>
              </div>

              {# Score badge #}
              {% if coaster.score is not null %}
                <div class="shrink-0 text-right hidden sm:block">
                  <div class="inline-flex items-center gap-1 px-2 py-1 rounded-lg bg-cc-warm-100 dark:bg-cc-warm-900/30">
                    {{ ux_icon('tabler:star-filled', {'class': 'w-4 h-4 text-cc-warm-500', 'aria-hidden': 'true'}) }}
                    <span class="font-semibold text-cc-warm-700 dark:text-cc-warm-400">{{ coaster.score|number_format(1) }}</span>
                  </div>
                </div>
              {% endif %}
            </div>
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    {% include 'components/empty_state.html.twig' with {
      icon: 'tabler:list-numbers',
      title: 'list.infotitle'|trans({}, 'top'),
      description: 'list.info'|trans({}, 'top')
    } %}
  {% endif %}
{% endblock %}
