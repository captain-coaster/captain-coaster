{% extends "layouts/base.html.twig" %}

{% import "macros/_macros_helpers.html.twig" as helper %}
{% import "macros/ui.html.twig" as ui %}

{% set title = 'list.title'|trans({}, 'top') %}
{% block title %}{{ title }}{% endblock %}

{% block body %}
  {# Hero Section #}
  <div class="mb-6">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <div>
        <h1 class="text-2xl font-bold text-neutral-900 dark:text-white mb-1">
          {{ ux_icon('tabler:trophy', {'class': 'w-7 h-7 inline-block text-cc-warm-500 mr-2', 'aria-hidden': 'true'}) }}
          {{ 'list.title'|trans({}, 'top') }}
        </h1>
        <p class="text-neutral-600 dark:text-neutral-400 text-sm">
          {{ 'list.info'|trans({}, 'top') }}
        </p>
      </div>
      {% if is_granted('ROLE_USER') %}
        <a href="{{ path('top_new') }}" 
           class="inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium rounded-xl bg-cc-blue-600 text-white hover:bg-cc-blue-700 transition-colors duration-200 shrink-0">
          {{ ux_icon('tabler:plus', {'class': 'w-4 h-4', 'aria-hidden': 'true'}) }}
          {{ 'list.create'|trans({}, 'top') }}
        </a>
      {% endif %}
    </div>
  </div>

  {# Tops Grid #}
  {% if tops|length > 0 %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      {% for top in tops %}
        <article class="group bg-white dark:bg-neutral-900 rounded-2xl shadow-sm hover:shadow-md transition-all duration-300 overflow-hidden border border-neutral-100 dark:border-neutral-800">
          {# Header with user info #}
          <div class="p-4 pb-3">
            <div class="flex items-start gap-3">
              <a href="{{ path('user_show', {'slug': top.user.slug}) }}" class="shrink-0">
                {{ helper.profilePicture(top.user, 'w-10 h-10 rounded-full object-cover ring-2 ring-white dark:ring-neutral-800') }}
              </a>
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2 mb-0.5">
                  {% if top.main %}
                    <span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-green-100 dark:bg-green-900/30">
                      {{ ux_icon('tabler:check', {'class': 'w-3 h-3 text-green-600 dark:text-green-400', 'aria-hidden': 'true'}) }}
                    </span>
                  {% endif %}
                  <h2 class="font-semibold text-neutral-900 dark:text-white truncate text-sm">
                    <a href="{{ path('top_show', {'id': top.id}) }}" class="hover:text-cc-blue-600 dark:hover:text-cc-blue-400 transition-colors">
                      {{ top.name }}
                    </a>
                  </h2>
                </div>
                <p class="text-xs text-neutral-500 dark:text-neutral-400">
                  {{ 'list.by'|trans({}, 'top') }}
                  <a href="{{ path('user_show', {'slug': top.user.slug}) }}" class="hover:text-cc-blue-600 dark:hover:text-cc-blue-400 transition-colors">
                    {{ top.user.displayName }}
                  </a>
                </p>
              </div>
            </div>
          </div>

          {# Top 3 Coasters Preview #}
          <div class="px-4 pb-3">
            <ol class="space-y-2">
              {% for topCoaster in top.topCoasters|slice(0,3) %}
                <li class="flex items-center gap-3 group/item">
                  <span class="flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold
                    {% if loop.index == 1 %}bg-cc-warm-100 dark:bg-cc-warm-900/30 text-cc-warm-600 dark:text-cc-warm-400
                    {% elseif loop.index == 2 %}bg-neutral-100 dark:bg-neutral-800 text-neutral-600 dark:text-neutral-400
                    {% else %}bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400{% endif %}">
                    {{ topCoaster.position }}
                  </span>
                  <a href="{{ path('show_coaster', {'id': topCoaster.coaster.id, 'slug': topCoaster.coaster.slug}) }}" 
                     class="flex-1 text-sm text-neutral-700 dark:text-neutral-300 truncate hover:text-cc-blue-600 dark:hover:text-cc-blue-400 transition-colors">
                    {{ topCoaster.coaster.name }}
                  </a>
                </li>
              {% endfor %}
            </ol>
          </div>

          {# Footer with stats #}
          <div class="px-4 py-3 bg-neutral-50 dark:bg-neutral-800/50 border-t border-neutral-100 dark:border-neutral-800">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3 text-xs text-neutral-500 dark:text-neutral-400">
                <span class="inline-flex items-center gap-1">
                  {{ ux_icon('tabler:list-numbers', {'class': 'w-3.5 h-3.5', 'aria-hidden': 'true'}) }}
                  {{ top.topCoasters|length }}
                </span>
                <span class="inline-flex items-center gap-1">
                  {{ ux_icon('tabler:clock', {'class': 'w-3.5 h-3.5', 'aria-hidden': 'true'}) }}
                  {{ top.updatedAt|ago }}
                </span>
              </div>
              <a href="{{ path('top_show', {'id': top.id}) }}" 
                 class="inline-flex items-center gap-1 text-xs font-medium text-cc-blue-600 dark:text-cc-blue-400 hover:text-cc-blue-700 dark:hover:text-cc-blue-300 transition-colors">
                {{ 'list.more'|trans({}, 'top') }}
                {{ ux_icon('tabler:chevron-right', {'class': 'w-3.5 h-3.5', 'aria-hidden': 'true'}) }}
              </a>
            </div>
          </div>
        </article>
      {% endfor %}
    </div>

    <div class="mt-6">
      {{ knp_pagination_render(tops) }}
    </div>
  {% else %}
    {% include 'components/empty_state.html.twig' with {
      icon: 'tabler:trophy',
      title: 'list.infotitle'|trans({}, 'top'),
      description: 'list.info'|trans({}, 'top')
    } %}
  {% endif %}
{% endblock %}
