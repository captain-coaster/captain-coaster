{% extends "base.html.twig" %}

{% set title = topName %}
{% block title %}{{ title }}{% endblock %}

{% set showSearchBar = 0 %}

{% form_theme form _self %}

{% block _top_topCoasters_entry_widget %}
  <li class="media coaster-entry" 
      draggable="true"
      data-coaster-id="{% if form.vars.data is not null %}{{ form.vars.data.coaster.id }}{% endif %}"
      data-position="{% if form.vars.data is not null %}{{ form.vars.data.position }}{% else %}1{% endif %}"
      data-top-list-target="item">
    {{ form_widget(form) }}

    <div class="media-left media-middle drag-handle" style="cursor: grab;">
      {{ heroicon('bars-3', 'w-6 h-6') }}
    </div>
    <div class="media-left media-middle">
        <span class="position-badge label label-rounded label-primary">{% if form.vars.data is not null %}{{ form.vars.data.position }}{% else %}1{% endif %}</span>
    </div>

    <div class="media-body">
      <h4>
        {{ form.vars.data.coaster.name|default('__coastername__') }}
        {% if form.vars.data is not null %}
          -
          {{ form.vars.data.coaster.park.name|default('') }}
          ({{ app.user.rating(form.vars.data.coaster).value|default('N/A') }})
        {% endif %}
      </h4>
    </div>

    <div class="media-right media-middle">
      <button type="button" class="remove-btn btn btn-link" data-action="click->top-list#removeCoaster">
        {{ heroicon('x-circle', 'w-6 h-6') }}
      </button>
    </div>
  </li>
{% endblock %}

{% block body %}
  <div class="panel panel-flat">
    <select class="js-data-example-ajax" 
            data-controller="enhanced-select"
            data-enhanced-select-searchable-value="true"
            data-enhanced-select-placeholder-value="{{ 'top.find'|trans }}">
        <option value="">{{ 'top.find'|trans }}</option>
    </select>
  </div>
  {{ form_start(form) }}
  <div class="panel panel-flat">
    <div class="panel-heading">
      <span class="panel-title">
        {{ 'top.info'|trans }}
      </span>
      {% if form.vars.errors is not empty %}
        <div class="alert alert-danger alert-styled-left alert-dismissible">
          {{ form_errors(form) }}
        </div>
      {% endif %}
    </div>
    <div class="panel-body">
      <ul id="top-coaster"
          data-prototype="{{ form_widget(form.topCoasters.vars.prototype)|e('html_attr') }}"
          class="media-list media-list-container"
          data-controller="top-list"
          data-top-list-target="list"
          data-top-list-auto-save-url-value="{{ path('top_auto_save', {'id': form.vars.data.id}) }}"
          data-top-list-save-delay-value="2000">
        {% for coaster in form.topCoasters %}
          {{ form_widget(coaster) }}
        {% endfor %}
      </ul>
    </div>
  </div>
  <button type="submit" class="btn bg-teal-400 btn-labeled pull-right">
    <b>{{ heroicon('pencil', 'w-6 h-6') }}</b> {{ 'top.save'|trans }}
  </button>
  {{ form_rest(form) }}
  {{ form_end(form) }}
{% endblock %}

{% block javascripts %}
  {# Modern Stimulus-based drag and drop will be implemented in task 2 #}
  {# Legacy jQuery sortable code removed - functionality will be restored with modern implementation #}
{% endblock %}
