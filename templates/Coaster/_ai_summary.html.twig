{% if coasterSummary %}
    <div class="panel panel-flat">
        <div class="panel-heading">
            <h6 class="panel-title">
                <span class="text-semibold">
                    {{ ux_icon('heroicons-solid:star', {'class': 'w-6 h-6 position-left'}) }} {{ 'ai_summary.panel.title'|trans({}, 'ai_summary') }}
                </span>
            </h6>
        </div>
        <div class="panel-body">
            <p class="text-muted mb-15">{{ coasterSummary.summary }}</p>
            {% if coasterSummary.dynamicPros|length > 0 or coasterSummary.dynamicCons|length > 0 %}
                {% import "helper.html.twig" as helper %}
                <div class="row">
                    {% if coasterSummary.dynamicPros|length > 0 %}
                        <div class="col-md-6">
                            <h6 style="color: #065f46;">{{ ux_icon('heroicons:check', {'class': 'w-5 h-5'}) }} {{ 'ai_summary.panel.highlights'|trans({}, 'ai_summary') }}</h6>
                            {% for pro in coasterSummary.dynamicPros %}
                                <span class="label label-success label-rounded">{{ pro }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                    {% if coasterSummary.dynamicCons|length > 0 %}
                        <div class="col-md-6">
                            <h6 style="color: #9f1239;">{{ ux_icon('heroicons:exclamation-triangle', {'class': 'w-5 h-5'}) }} {{ 'ai_summary.panel.concerns'|trans({}, 'ai_summary') }}</h6>
                            {% for con in coasterSummary.dynamicCons %}
                                <span class="label label-danger label-rounded">{{ con }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% endif %}
            
            <!-- Feedback Section -->
            <div class="summary-feedback-section">
                <div class="row">
                    <div class="col-md-6">
                        <small class="text-muted">{{ ux_icon('heroicons:information-circle', {'class': 'w-6 h-6'}) }} {{ 'ai_summary.info.based_on'|trans({'count': coasterSummary.reviewsAnalyzed}, 'ai_summary') }}</small>
                    </div>
                    <div class="col-md-6 text-right">
                        <div 
                            class="summary-feedback-buttons"
                            data-controller="summary-feedback"
                            data-summary-feedback-summary-id-value="{{ coasterSummary.id }}"
                            data-summary-feedback-feedback-url-value="{{ path('summary_feedback', {'id': coasterSummary.id}) }}"
                            data-summary-feedback-csrf-token-value="{{ csrf_token('summary_feedback') }}"
                            data-summary-feedback-success-message-value="{{ 'ai_summary.feedback.success'|trans({}, 'ai_summary') }}"
                            data-summary-feedback-error-message-value="{{ 'ai_summary.feedback.error'|trans({}, 'ai_summary') }}"
                            data-summary-feedback-helpful-title-value="{{ 'ai_summary.feedback.button.helpful'|trans({}, 'ai_summary') }}"
                            data-summary-feedback-not-helpful-title-value="{{ 'ai_summary.feedback.button.not_helpful'|trans({}, 'ai_summary') }}"
                            data-summary-feedback-voted-helpful-title-value="{{ 'ai_summary.feedback.button.voted_helpful'|trans({}, 'ai_summary') }}"
                            data-summary-feedback-voted-not-helpful-title-value="{{ 'ai_summary.feedback.button.voted_not_helpful'|trans({}, 'ai_summary') }}"
                            {% if userFeedbackState %}
                                data-summary-feedback-user-vote-value="{% if userFeedbackState['hasVoted'] %}{{ userFeedbackState['isPositive'] ? 'positive' : 'negative' }}{% endif %}"
                                data-summary-feedback-has-voted-value="{{ userFeedbackState['hasVoted'] ? 'true' : 'false' }}"
                            {% else %}
                                data-summary-feedback-user-vote-value=""
                                data-summary-feedback-has-voted-value="false"
                            {% endif %}
                            style="display: inline-flex; align-items: center; gap: 8px; justify-content: flex-end;"
                        >
                            <small class="text-muted" style="margin-right: 8px;">{{ 'ai_summary.feedback.prompt'|trans({}, 'ai_summary') }}</small>
                            <div style="display: inline-flex; gap: 2px;">
                                <button 
                                    type="button" 
                                    class="btn-link text-success p-0 border-0 bg-transparent"
                                    data-summary-feedback-target="thumbsUpButton"
                                    data-action="click->summary-feedback#thumbsUp"
                                    title="{{ 'ai_summary.feedback.button.helpful'|trans({}, 'ai_summary') }}"
                                    style="cursor: pointer; display: inline-flex; align-items: center;"
                                >
                                    <span data-summary-feedback-target="thumbsUpIcon">{{ ux_icon('heroicons:hand-thumb-up', {'class': 'w-6 h-6'}) }}</span>
                                </button>
                                <button 
                                    type="button" 
                                    class="btn-link text-danger p-0 border-0 bg-transparent"
                                    data-summary-feedback-target="thumbsDownButton"
                                    data-action="click->summary-feedback#thumbsDown"
                                    title="{{ 'ai_summary.feedback.button.not_helpful'|trans({}, 'ai_summary') }}"
                                    style="cursor: pointer; display: inline-flex; align-items: center;"
                                >
                                    <span data-summary-feedback-target="thumbsDownIcon">{{ ux_icon('heroicons:hand-thumb-down', {'class': 'w-6 h-6'}) }}</span>
                                </button>
                            </div>
                            <span style="display: none;">
                                <span data-summary-feedback-target="positiveCount">{{ coasterSummary.positiveVotes }}</span>
                                <span data-summary-feedback-target="negativeCount">{{ coasterSummary.negativeVotes }}</span>
                            </span>
                            <span 
                                data-summary-feedback-target="loadingIndicator" 
                                class="ml-5" 
                                style="display: none;"
                            >
                                <span style="font-size: 10px;">{{ ux_icon('heroicons:arrow-path', {'class': 'w-6 h-6 spinner'}) }}</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% else %}
    <!-- No summary available -->
    <div style="display: none;"></div>
{% endif %}