{% if coasterSummary %}
    <div class="panel panel-flat">
        <div class="panel-heading">
            <h6 class="panel-title">
                <span class="text-semibold">
                    {{ heroicon('star', 'w-6 h-6 position-left', 'solid') }} Captain's Review
                </span>
            </h6>
        </div>
        <div class="panel-body">
            <p class="text-muted mb-15">{{ coasterSummary.summary }}</p>
            {% if coasterSummary.dynamicPros|length > 0 or coasterSummary.dynamicCons|length > 0 %}
                {% import "helper.html.twig" as helper %}
                <div class="row">
                    {% if coasterSummary.dynamicPros|length > 0 %}
                        <div class="col-md-6">
                            <h6 style="color: #065f46;">{{ heroicon('check', 'w-5 h-5') }} {{ 'coaster.ai_summary.highlights'|trans }}</h6>
                            {% for pro in coasterSummary.dynamicPros %}
                                <span class="label label-success label-rounded">{{ pro }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                    {% if coasterSummary.dynamicCons|length > 0 %}
                        <div class="col-md-6">
                            <h6 style="color: #9f1239;">{{ heroicon('exclamation-triangle', 'w-5 h-5') }} {{ 'coaster.ai_summary.concerns'|trans }}</h6>
                            {% for con in coasterSummary.dynamicCons %}
                                <span class="label label-danger label-rounded">{{ con }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% endif %}
            
            <!-- Feedback Section -->
            <div class="summary-feedback-section">
                <div class="row">
                    <div class="col-md-6">
                        <small class="text-muted">{{ heroicon('information-circle', 'w-6 h-6') }} AI-generated summary based on {{ coasterSummary.reviewsAnalyzed }} reviews</small>
                    </div>
                    <div class="col-md-6 text-right">
                        <div 
                            class="summary-feedback-buttons"
                            data-controller="summary-feedback"
                            data-summary-feedback-summary-id-value="{{ coasterSummary.id }}"
                            data-summary-feedback-feedback-url-value="{{ path('summary_feedback', {'id': coasterSummary.id}) }}"
                            data-summary-feedback-csrf-token-value="{{ csrf_token('summary_feedback_' ~ coasterSummary.id) }}"
                            {% if userFeedbackState %}
                                data-summary-feedback-user-vote-value="{% if userFeedbackState['hasVoted'] %}{{ userFeedbackState['isPositive'] ? 'positive' : 'negative' }}{% endif %}"
                                data-summary-feedback-has-voted-value="{{ userFeedbackState['hasVoted'] ? 'true' : 'false' }}"
                            {% else %}
                                data-summary-feedback-user-vote-value=""
                                data-summary-feedback-has-voted-value="false"
                            {% endif %}
                            style="display: inline-flex; align-items: center; gap: 8px; justify-content: flex-end;"
                        >
                            <small class="text-muted" style="margin-right: 8px;">Was this helpful?</small>
                            <div style="display: inline-flex; gap: 2px;">
                                <button 
                                    type="button" 
                                    class="btn-link text-success p-0 border-0 bg-transparent"
                                    data-summary-feedback-target="thumbsUpButton"
                                    data-action="click->summary-feedback#thumbsUp"
                                    title="Mark as helpful"
                                    style="cursor: pointer; display: inline-flex; align-items: center;"
                                >
                                    <span data-summary-feedback-target="thumbsUpIcon">{{ heroicon('hand-thumb-up', 'w-6 h-6') }}</span>
                                </button>
                                <button 
                                    type="button" 
                                    class="btn-link text-danger p-0 border-0 bg-transparent"
                                    data-summary-feedback-target="thumbsDownButton"
                                    data-action="click->summary-feedback#thumbsDown"
                                    title="Mark as not helpful"
                                    style="cursor: pointer; display: inline-flex; align-items: center;"
                                >
                                    <span data-summary-feedback-target="thumbsDownIcon">{{ heroicon('hand-thumb-down', 'w-6 h-6') }}</span>
                                </button>
                            </div>
                            <span style="display: none;">
                                <span data-summary-feedback-target="positiveCount">{{ coasterSummary.positiveVotes }}</span>
                                <span data-summary-feedback-target="negativeCount">{{ coasterSummary.negativeVotes }}</span>
                            </span>
                            <span 
                                data-summary-feedback-target="loadingIndicator" 
                                class="ml-5" 
                                style="display: none;"
                            >
                                <span style="font-size: 10px;">{{ heroicon('arrow-path', 'w-6 h-6 spinner') }}</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% else %}
    <!-- No summary available -->
    <div style="display: none;"></div>
{% endif %}