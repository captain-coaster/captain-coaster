<!-- Rating Panel -->
<div class="panel panel-body border-top-primary text-center">
    <h6 class="no-margin text-semibold">{{ 'coaster.rating.action'|trans }}</h6>
    <br/>
    
    {% if is_granted('ROLE_USER') %}
        <!-- Star Rating Widget -->
        {% include 'Coaster/_rating_widget.html.twig' with {'coaster': coaster, 'rating': rating} only %}
        
        <!-- Action Buttons -->
        <div class="rating-actions mt-10" 
             data-controller="rating-actions"
             {% if rating %}data-rating-actions-rating-id-value="{{ rating.id }}"{% endif %}
             data-rating-actions-locale-value="{{ app.request.locale }}">
            
            <a class="action-icon" 
               href="{{ path('review_form', {'id': coaster.id}) }}"
               title="{% if rating %}{{ 'coaster.rating.updatereview'|trans }}{% else %}{{ 'coaster.rating.sendreview'|trans }}{% endif %}">
                <i class="icon-pencil3"></i>
            </a>
            
            {% if user and not user.isAddTodayDateWhenRating %}
            <div class="inline-date-picker"
                 data-controller="rating-date"
                 {% if rating %}data-rating-date-rating-id-value="{{ rating.id }}"{% endif %}
                 data-rating-date-update-url-value="{{ path('rating_edit', {'id': coaster.id }) }}">
                <a class="action-icon"
                   data-action="click->rating-date#toggleDatePicker"
                   href="#"
                   style="{% if not rating %}display: none;{% endif %}"
                   data-rating-date-target="calendarButton"
                   title="{% if rating and rating.riddenAt %}{{ 'Rode on'|trans }} {{ rating.riddenAt|date('M j, Y') }} - {{ 'click to change'|trans }}{% else %}{{ 'Set ride date'|trans }}{% endif %}">
                    <i class="icon-calendar"></i>
                    {% if rating and rating.riddenAt %}
                        <span class="date-indicator"></span>
                    {% endif %}
                </a>
                
                <!-- Date Picker Popup -->
                <div data-rating-date-target="dateContainer" 
                     class="date-picker-popup-inline">
                    <div class="date-picker-content-small">
                        <input type="date" 
                               class="small-date-input"
                               data-rating-date-target="dateInput"
                               data-action="change->rating-date#dateChanged"
                               {% if rating and rating.riddenAt %}value="{{ rating.riddenAt|date('Y-m-d') }}"{% endif %}
                               max="{{ 'now'|date('Y-m-d') }}">
                        <div class="small-date-actions">
                            <button type="button" 
                                    class="tiny-btn today-btn"
                                    data-action="click->rating-date#setToday">{{ 'Today'|trans }}</button>
                            <button type="button" 
                                    class="tiny-btn clear-btn"
                                    data-action="click->rating-date#clearDate">{{ 'Clear'|trans }}</button>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <a class="action-icon delete-icon" 
               data-action="click->rating-actions#delete"
               data-rating-actions-target="deleteButton"
               href="#"
               style="{% if not rating %}display: none;{% endif %}"
               title="{{ 'coaster.rating.delete'|trans }}">
                <i class="icon-bin"></i>
            </a>
        </div>
    {% else %}
        <p class="text-muted content-group-sm">
            {{ 'coaster.rating.mustlogin'|trans }}
        </p>
        <a href="{{ path('login') }}">{{ 'coaster.rating.login'|trans }}</a>
    {% endif %}
</div>
<!-- /Rating Panel -->