{% extends 'base.html.twig' %}

{% import 'helper.html.twig' as helper %}

{% set title = coaster.name %}
{% set subTitle = coaster.park.name %}
{% block title %}
    {{ title }} • {{ subTitle }}
{% endblock %}
{% if coaster.formerNames %}
    {% set secondaryTitle = coaster.formerNames|join(', ') %}
{% endif %}

{% block body %}
    <div class="container mx-auto px-4 py-8">
        <!-- Hero Section with Cover Image, Score, and Main Info -->
        <div class="relative mb-8">
            <!-- Cover Image Background -->
            <div class="w-full h-96 bg-base-300 rounded-t-box overflow-hidden relative">
                {% if coaster.mainImage %}
                    <img
                        src="{{ pictures_cdn|default('/images') }}/1440x1440/{{ coaster.mainImage.filename }}"
                        class="w-full h-full object-cover opacity-60"
                        alt="{{ coaster.name }}"
                    />
                {% else %}
                    <div class="w-full h-full bg-gradient-to-r from-base-300 to-base-200"></div>
                {% endif %}

                <!-- Overlay Gradient -->
                <div class="absolute inset-0 bg-gradient-to-t from-base-100 to-transparent"></div>
            </div>

            <!-- Content Section -->
            <div class="relative z-10 px-6 -mt-32 pb-6">
                <div class="flex flex-col md:flex-row gap-6">
                    <!-- Left Column - Main Image -->
                    <div class="w-full md:w-1/3 lg:w-1/4">
                        <div class="aspect-[2/3] rounded-box overflow-hidden shadow-xl">
                            {% if coaster.mainImage %}
                                <img
                                    src="{{ pictures_cdn|default('/images') }}/1440x1440/{{
                                    coaster.mainImage.filename
                                    }}"
                                    class="w-full h-full object-cover"
                                    alt="{{ coaster.name }}"
                                />
                            {% else %}
                                <div class="w-full h-full bg-base-300 flex items-center justify-center">
                                    <span class="text-4xl opacity-30">{{ coaster.name|slice(0, 1) }}</span>
                                </div>
                            {% endif %}
                        </div>

                        <!-- Rating Action Button -->
                        {% if coaster.isRateable and is_granted('ROLE_USER') %}
                            <div class="mt-4">
                                <a href="{{ path('review_form', { id: coaster.id }) }}" class="btn btn-primary w-full">
                                    {{ 'coaster.rating.action'|trans }}
                                </a>
                            </div>
                        {% elseif coaster.isRateable %}
                            <div class="mt-4">
                                <a href="{{ path('login') }}" class="btn btn-outline btn-primary w-full">
                                    {{ 'coaster.rating.login'|trans }}
                                </a>
                            </div>
                        {% endif %}
                    </div>

                    <!-- Right Column - Info -->
                    <div class="w-full md:w-2/3 lg:w-3/4">
                        <!-- Title and Park -->
                        <h1 class="text-4xl font-bold">{{ coaster.name }}</h1>
                        <p class="text-xl mt-2">
                            <a
                                href="{{ path('park_show', { id: coaster.park.id, slug: coaster.park.slug }) }}"
                                class="link link-hover"
                            >
                                {{ coaster.park.name }}
                            </a>
                            {% if coaster.park.country %}
                                • <a href="{{ path('ranking_index', { 'filters[country]': coaster.park.country.id }) }}" class="link link-hover">{{
                                        coaster.park.country.name|trans([], 'database')
                                    }}</a>
                            {% endif %}
                        </p>
                        {% if coaster.formerNames %}
                            <p class="text-sm opacity-70 mt-1">
                                {{ 'coaster.infos.formernames'|trans }}: {{ coaster.formerNames|join(', ') }}
                            </p>
                        {% endif %}

                        <!-- Score and Ranking -->
                        {% if coaster.score %}
                            <div class="flex flex-wrap items-center gap-6 mt-6">
                                <div class="flex items-center justify-center">
                                    <!-- Improved Radial Progress with Full Circle and Color Gradient -->
                                    <div class="relative flex items-center justify-center">
                                        <!-- Background Circle (always visible) -->
                                        <div
                                            class="radial-progress opacity-20 absolute"
                                            style="--value:100; --size:7rem; --thickness: 0.6rem; color: #ddd;"
                                        ></div>
                                        <!-- Colored Progress Circle with dynamic color based on score -->
                                        <div
                                            class="radial-progress relative"
                                            style="--value:{{
                                            coaster.score
                                            }}; --size:7rem; --thickness: 0.6rem;
                                                   {% if coaster.score < 20 %}
                                                       color: #ff4040;
                                                   {% elseif coaster.score < 40 %}
                                                       color: #ff8c40;
                                                   {% elseif coaster.score < 60 %}
                                                       color: #ffdc40;
                                                   {% elseif coaster.score < 80 %}
                                                       color: #a0ff40;
                                                   {% else %}
                                                       color: #40ff40;
                                                   {% endif %}
                                                  "
                                        >
                                            <span class="text-3xl font-bold">
                                                {{ coaster.score|number_format(1, ',') }}%
                                            </span>
                                        </div>
                                    </div>
                                    <div class="ml-3">
                                        <div class="text-sm opacity-70">
                                            {{ 'coaster.score.scoreof'|trans }}
                                        </div>
                                        {% set perPage =
                                            constant('App\\Controller\\RankingController::COASTERS_PER_PAGE')
                                        %}
                                        {% set page = (coaster.rank / perPage)|round(0, 'ceil') %}
                                        <a
                                            href="{{ path('ranking_index', { page: page }) }}"
                                            class="link link-hover flex items-center"
                                        >
                                            <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="h-4 w-4 mr-1"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                                                />
                                            </svg>
                                            {{ 'coaster.score.ranked'|trans }}
                                            <span class="badge badge-neutral">#{{ coaster.rank }}</span>
                                            {{ 'coaster.score.intheworld'|trans }}
                                        </a>
                                    </div>
                                </div>

                                <!-- Main Characteristics with Icons -->
                                <div class="flex flex-wrap gap-3">
                                    {% if coaster.height is not empty %}
                                        <div class="badge badge-lg gap-1">
                                            <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="h-4 w-4"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
                                                />
                                            </svg>
                                            {{ 'coaster.infos.height'|trans }}: {{ units.m_or_f(coaster.height) }}
                                        </div>
                                    {% endif %}
                                    {% if coaster.speed is not empty %}
                                        <div class="badge badge-lg gap-1">
                                            <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="h-4 w-4"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M13 10V3L4 14h7v7l9-11h-7z"
                                                />
                                            </svg>
                                            {{ 'coaster.infos.speed'|trans }}: {{ units.kph_or_mph(coaster.speed) }}
                                        </div>
                                    {% endif %}
                                    {% if coaster.length is not empty %}
                                        <div class="badge badge-lg gap-1">
                                            <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="h-4 w-4"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"
                                                />
                                            </svg>
                                            {{ 'coaster.infos.length'|trans }}: {{ units.m_or_f(coaster.length) }}
                                        </div>
                                    {% endif %}
                                    {% if coaster.inversionsNumber %}
                                        <div class="badge badge-lg gap-1">
                                            <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="h-4 w-4"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                                                />
                                            </svg>
                                            {{ 'coaster.infos.inversions'|trans }}: {{ coaster.inversionsNumber }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}

                        <!-- Main Tags -->
                        {% if (coaster.mainTags|length) > 0 %}
                            <div class="mt-6 flex flex-wrap gap-2">
                                {% for mainTag in coaster.mainTags %}
                                    {% if mainTag.tag.type == 'pro' %}
                                        <span class="badge badge-success badge-lg">
                                            {{ mainTag.tag.name|trans([], 'database') }}
                                        </span>
                                    {% else %}
                                        <span class="badge badge-error badge-lg">
                                            {{ mainTag.tag.name|trans([], 'database') }}
                                        </span>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% endif %}

                        <!-- Review Summary -->
                        <div class="mt-6 p-4 bg-base-200 rounded-box">
                            <p class="text-lg italic">
                                "This coaster offers thrilling drops and smooth inversions. Most riders praise its
                                intensity and airtime, though some mention the restraints can be uncomfortable."
                            </p>
                            <p class="text-sm mt-2 opacity-70">
                                AI-generated summary based on user reviews
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Placeholder for the rest of the content -->
        <div class="p-8 text-center bg-base-200 rounded-box">
            <p class="text-lg">
                The rest of the content will be implemented later.
            </p>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/fosjsrouting/js/router.min.js') }}"></script>
    <script src="{{ path('fos_js_routing_js') }}"></script>
{% endblock %}
