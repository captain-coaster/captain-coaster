/**
 * Icon Utility for JavaScript
 * 
 * References icons from the SVG sprite generated by Webpack.
 * Uses Webpack Encore's manifest for versioned URLs (cache busting).
 * 
 * The sprite is automatically built during Webpack compilation by scanning
 * all Twig templates and JavaScript files for icon usage.
 * 
 * Usage:
 *   import { heroicon } from './utils/heroicon';
 *   const html = heroicon('cog-6-tooth', 'w-5 h-5');
 *   const html = heroicon('star-half', 'w-6 h-6');
 */

// Cache for sprite URL from manifest
let spriteUrl = null;

/**
 * Get the versioned sprite URL from Webpack Encore's manifest
 */
function getSpriteUrl() {
    if (spriteUrl) {
        return spriteUrl;
    }
    
    // Load manifest.json to get versioned sprite URL
    try {
        // In production, Encore adds hashes to filenames
        // manifest.json maps logical names to versioned filenames
        const manifestPath = '/build/manifest.json';
        
        // Try to get from window if already loaded
        if (window.__ENCORE_MANIFEST__) {
            spriteUrl = window.__ENCORE_MANIFEST__['build/icons.svg'] || '/build/icons.svg';
            return spriteUrl;
        }
        
        // Fallback: use non-versioned path (works in dev mode)
        spriteUrl = '/build/icons.svg';
        
        // Async load manifest for future calls (don't block)
        fetch(manifestPath)
            .then(res => res.json())
            .then(manifest => {
                window.__ENCORE_MANIFEST__ = manifest;
                spriteUrl = manifest['build/icons.svg'] || '/build/icons.svg';
            })
            .catch(() => {
                // Manifest not found, use default path
            });
        
        return spriteUrl;
    } catch (error) {
        // Fallback to non-versioned path
        return '/build/icons.svg';
    }
}

/**
 * Render an icon from the SVG sprite
 * 
 * @param {string} name - Icon name (e.g., 'cog-6-tooth', 'star-half')
 * @param {string} className - CSS classes to add to the SVG
 * @param {string} variant - Icon variant (ignored, auto-detected by sprite builder)
 * @returns {string} SVG HTML string with <use> reference
 */
export function heroicon(name, className = '', variant = 'outline') {
    const spriteUrl = getSpriteUrl();
    const classAttr = className ? ` class="${className}"` : '';
    return `<svg${classAttr}><use href="${spriteUrl}#icon-${name}"/></svg>`;
}
